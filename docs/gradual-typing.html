<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Gradual Typing · Pyre</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;p&gt;The term gradual typing describes a type system where not every expression is typed.&lt;/p&gt;
"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Gradual Typing · Pyre"/><meta property="og:type" content="website"/><meta property="og:url" content="https://pyre-check.org/index.html"/><meta property="og:description" content="&lt;p&gt;The term gradual typing describes a type system where not every expression is typed.&lt;/p&gt;
"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/integrated_logo_light.png" alt="Pyre"/></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/installation.html" target="_self">Getting Started</a></li><li class="siteNavGroupActive"><a href="/docs/overview.html" target="_self">Documentation</a></li><li class=""><a href="https://github.com/facebook/pyre-check" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Contents</span></h2></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Contents</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/installation.html">Installation</a></li><li class="navListItem"><a class="navItem" href="/docs/guided-tour.html">Guided Tour</a></li><li class="navListItem"><a class="navItem" href="/docs/configuration.html">Configuring Pyre</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/gradual-typing.html">Gradual Typing</a></li><li class="navListItem"><a class="navItem" href="/docs/error-suppression.html">Error Suppression</a></li><li class="navListItem"><a class="navItem" href="/docs/error-types.html">Error Types</a></li><li class="navListItem"><a class="navItem" href="/docs/lsp-integration.html">Editor Integration</a></li><li class="navListItem"><a class="navItem" href="/docs/watchman-integration.html">Watchman Integration</a></li><li class="navListItem"><a class="navItem" href="/docs/querying-pyre.html">Querying Pyre</a></li><li class="navListItem"><a class="navItem" href="/docs/static-analysis-post-processor.html">Static Analysis Processor</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              const headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                if (event.target.tagName === 'A') {
                  document.body.classList.remove('tocActive');
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle">Gradual Typing</h1></header><article><div><span><p>The term gradual typing describes a type system where not every expression is typed.
Pyre allows users to explicitly specify how strict the type checking should be on a per-file basis.</p>
<p>By default, untyped expressions are assumed to be type Any, which is defined as having
every attribute and being a sub- and super-type of every other known type.
This is useful for annotating functions relying on untyped library code:</p>
<pre><code class="hljs">  def foo() -&gt; int:
    return unannotated_library_function() # has<span class="hljs-built_in"> type </span>`Any`, which is a subtype of `int`
</code></pre>
<p>There will be no type error in the above code, so we can annotate our function without
having to edit the library function we're using.
This can be desirable or necessary, but also gives us very weak guarantees about our code.</p>
<h2><a class="anchor" aria-hidden="true" id="strict-mode"></a><a href="#strict-mode" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Strict Mode</h2>
<p>Pyre supports a strict mode where the above code will no longer type check.
Strict mode can be enabled by annotating a file with <code># pyre-strict</code>.</p>
<pre><code class="hljs">  # pyre-strict
  def foo() -&gt; int:
    return unannotated_library_function()  #<span class="hljs-built_in"> type </span>error: expected `int` but got `Any`
</code></pre>
<p>In case the callee is not under our control we can either suppress the error
(<code># pyre-ignore</code>) or create stubs for the library function.
Pyre uses <a href="https://github.com/python/typeshed">typeshed</a>, a collection of stubs
for the standard library originally built to support MyPy.
Pyre also supports custom, repository local stubs.</p>
<h2><a class="anchor" aria-hidden="true" id="declarative-mode"></a><a href="#declarative-mode" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Declarative Mode</h2>
<p>In case we're in control of the library function we can now go in and annotate that function too</p>
<pre><code class="hljs">  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unannotated_library_function</span><span class="hljs-params">()</span> -&gt; int:</span>
    <span class="hljs-keyword">return</span> sometimes_returns_a_string(return_string=<span class="hljs-literal">False</span>)  <span class="hljs-comment"># uh oh...</span>
</code></pre>
<p>This example is contrived but not unrealistic. Especially when transitioning from a highly dynamic
codebase to a statically typed one this happens quite frequently.
We could go in, refactor and clean up sometimes_returns_a_string to behave more consistently
but more likely than not this will just put us in the same situation over and over again.</p>
<p>Pyre solves this problem with a per-file declarative mode:</p>
<pre><code class="hljs">  <span class="hljs-comment"># pyre-ignore-all-errors</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unannotated_library_function</span><span class="hljs-params">()</span> -&gt; int:</span>
    <span class="hljs-keyword">return</span> sometimes_returns_a_string(return_string=<span class="hljs-literal">False</span>)  <span class="hljs-comment"># this is fine</span>
</code></pre>
<p>This tells Pyre to take all annotations at face value (so dependencies type check),
but allows us to deal with internal type correctness later.</p>
<h2><a class="anchor" aria-hidden="true" id="suppressing-specific-errors"></a><a href="#suppressing-specific-errors" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Suppressing Specific Errors</h2>
<p>In some cases we may have a file that will almost meet type-checking save for a few specific kinds
of dynamic behavior.
If we have a file with several of these above kind of incompatible return type errors, we could
suppress all of them, but no other kinds of errors with:</p>
<pre><code class="hljs">  <span class="hljs-comment"># pyre-ignore-all-errors[7]</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unannotated_library_function_A</span><span class="hljs-params">()</span> -&gt; int:</span>
    <span class="hljs-keyword">return</span> sometimes_returns_a_string(return_string=<span class="hljs-literal">False</span>)  <span class="hljs-comment"># this is fine</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">unannotated_library_function_B</span><span class="hljs-params">()</span> -&gt; str:</span>
    <span class="hljs-keyword">return</span> sometimes_returns_a_string(return_string=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># this is also fine (in the same file)</span>
</code></pre>
<p>This gives you access to as much static typing as you can handle at a given point.</p>
<p>However, this should be a stopgap solution, and not a permanent fix.  Suppressing an entire class
of errors is still pretty dangerous, and over time you should try to converge to full compliance.</p>
<h2><a class="anchor" aria-hidden="true" id="stubs"></a><a href="#stubs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Stubs</h2>
<p>You might have some highly dynamic code that Pyre is having trouble analyzing and
getting accurate annotations for - say, <code>file.py</code>.
In this case, you can add a stub <code>file.pyi</code> in the same directory that contains
the annotations for classes &amp; functions, and omit the implementations.</p>
<pre><code class="hljs">  <span class="hljs-comment"># file.py</span>
  <span class="hljs-keyword">from</span> memoizer <span class="hljs-keyword">import</span> memoize

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span>:</span>
   cached_fetch = <span class="hljs-literal">None</span>

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fetch</span><span class="hljs-params">(self, id)</span>:</span>
    <span class="hljs-keyword">return</span> get_from_network(id)

  C.cached_fetch = memoize(fetch)

  <span class="hljs-comment"># file.pyi</span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">C</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">cached_fetch</span><span class="hljs-params">(self, id: str)</span> -&gt; HttpResponse:</span> ...
</code></pre>
<p>Here, Pyre will ignore the contents of <code>file.py</code>, and won't know about the existence
of <code>fetch</code> and a function that takes an unexpected self argument,
instead only seeing the intended signatures.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/configuration.html"><span class="arrow-prev">← </span><span>Configuring Pyre</span></a><a class="docs-next button" href="/docs/error-suppression.html"><span>Error Suppression</span><span class="arrow-next"> →</span></a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="https://code.facebook.com/projects/" target="_blank" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><a href="https://code.facebook.com/projects/" target="_blank">Open Source Projects</a><a href="https://github.com/facebook/" target="_blank">Github</a><a href="https://twitter.com/fbOpenSource" target="_blank">Twitter</a><a href="https://github.com/facebook/pyre-check" target="_blank">Contribute to Pyre</a></section></footer></div></body></html>