<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-pysa-model-generators">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Dynamically Generating Models | Pyre</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://pyre-check.org/img/docusaurus.png"><meta data-rh="true" name="twitter:image" content="https://pyre-check.org/img/docusaurus.png"><meta data-rh="true" property="og:url" content="https://pyre-check.org/docs/pysa-model-generators/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Dynamically Generating Models | Pyre"><meta data-rh="true" name="description" content="Some sources and sinks may be too numerous or too rapidly changing for defining"><meta data-rh="true" property="og:description" content="Some sources and sinks may be too numerous or too rapidly changing for defining"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pyre-check.org/docs/pysa-model-generators/"><link data-rh="true" rel="alternate" href="https://pyre-check.org/docs/pysa-model-generators/" hreflang="en"><link data-rh="true" rel="alternate" href="https://pyre-check.org/docs/pysa-model-generators/" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8CK1L365DB"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-8CK1L365DB",{})</script>




<script src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/assets/css/styles.42127f68.css">
<link rel="preload" href="/assets/js/runtime~main.244374e3.js" as="script">
<link rel="preload" href="/assets/js/main.ba1c0690.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#20232a;color:#fff" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">Support Ukraine ðŸ‡ºðŸ‡¦ <a target="_blank" rel="noopener noreferrer" href="https://opensource.fb.com/support-ukraine"> Help Provide Humanitarian Aid to Ukraine</a>.</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/integrated_logo_light.png" alt="Pyre Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/integrated_logo_light.png" alt="Pyre Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Documentation</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/getting-started/">Type Checking (Pyre)</a></li><li><a class="dropdown__link" href="/docs/pysa-basics/">Static Analysis (Pysa)</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/pyre-check" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/pysa-quickstart/">Quickstart</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/pysa-basics/">How Pysa Works</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/pysa-running/">Running Pysa</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/pysa-shipping-rules-models/">Shipping Pysa Models and Rules</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/pysa-model-generators/">Scaling Beyond Individual Models</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/pysa-model-generators/">Dynamically Generating Models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pysa-model-dsl/">Model DSL</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="true" href="/docs/category/user-docs/">User Docs</a><button aria-label="Toggle the collapsible sidebar category &#x27;User Docs&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pysa-false-positives-negatives/">Debugging False Positives and False Negatives</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pysa-explore/">Exploring Taint Models Interactively</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pysa-coverage/">Coverage Increasing Strategies</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/pysa-tips/">General Tips</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/static-analysis-post-processor/">Static Analysis Processor</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/warning_codes/overview-public/">Warning Codes</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/pysa-additional-resources/">Additional Resources</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Scaling Beyond Individual Models</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Dynamically Generating Models</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Dynamically Generating Models</h1></header><p>Some sources and sinks may be too numerous or too rapidly changing for defining
them statically to be practical. For these scenarios, Pysa has the concept of
model generators, which can generate taint models by reading the project&#x27;s source code before static analysis is
started. The current set of model generators is stored in
<a href="https://github.com/facebook/pyre-check/tree/main/tools/generate_taint_models" target="_blank" rel="noopener noreferrer"><code>tools/generate_taint_models</code></a>
within the pyre-check repository.</p><p>Pysa now has the concept of a <a href="/docs/pysa-model-dsl/">Model DSL</a>, which supports
some model generation usecases which could previously only be done with model
generators. You should prefer the Model DSL if it supports your usecase.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-model-generators">Running Model Generators<a class="hash-link" href="#running-model-generators" title="Direct link to heading">â€‹</a></h2><p>The majority of model generators require access to a running environment. For
example, the <code>RESTApiSourceGenerator</code> needs to be able to access <code>urlpatterns</code>
configured for Django, meaning it has to import (and implicitly run) the file
you use to configure routing. The recommended way to run model generators is to set
up a small script within your repository that can run within the virtual
environment for your project. <strong><a href="https://github.com/facebook/pyre-check/tree/main/documentation/pysa_tutorial/exercise5" target="_blank" rel="noopener noreferrer">This tutorial
exercise</a>
provides an example of how to setup and use model generators.</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="example-model-generators">Example Model Generators<a class="hash-link" href="#example-model-generators" title="Direct link to heading">â€‹</a></h2><p>The set of model generators is always changing, but below are some examples of
model generators which are currently provided out of the box with Pysa.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="restapisourcegenerator"><a href="https://github.com/facebook/pyre-check/blob/main/tools/generate_taint_models/get_REST_api_sources.py" target="_blank" rel="noopener noreferrer"><code>RESTApiSourceGenerator</code></a><a class="hash-link" href="#restapisourcegenerator" title="Direct link to heading">â€‹</a></h3><p>This model generator is intended to taint all arguments to <a href="https://docs.djangoproject.com/en/2.2/topics/http/views/" target="_blank" rel="noopener noreferrer">Django view
functions</a> as
<code>UserControlled</code>. This is useful when you have views that receive
user-controlled data as arguments separate from the <code>HttpRequest</code> parameter,
such as when <a href="https://docs.djangoproject.com/en/2.2/topics/http/urls/#example" target="_blank" rel="noopener noreferrer">capturing values from the request
path</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="exitnodegenerator"><a href="https://github.com/facebook/pyre-check/blob/main/tools/generate_taint_models/get_exit_nodes.py" target="_blank" rel="noopener noreferrer"><code>ExitNodeGenerator</code></a><a class="hash-link" href="#exitnodegenerator" title="Direct link to heading">â€‹</a></h3><p>This generator is intended to taint all data returned from <a href="https://docs.djangoproject.com/en/2.2/topics/http/views/" target="_blank" rel="noopener noreferrer">Django view
functions</a> as
<code>ReturnedToUser</code>. This is useful when you have decorators which allow your view
functions to return raw python types, rather than <code>HttpResponse</code> objects. Note
that you do not need this generator if you always construct <code>HttpResponse</code>
objects, because they are already annotated as <code>ReturnedToUser</code> sinks.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="graphqlsourcegenerator"><a href="https://github.com/facebook/pyre-check/blob/main/tools/generate_taint_models/get_graphql_sources.py" target="_blank" rel="noopener noreferrer"><code>GraphQLSourceGenerator</code></a><a class="hash-link" href="#graphqlsourcegenerator" title="Direct link to heading">â€‹</a></h3><p>This model generator is similar to the <code>RESTApiSourceGenerator</code> and
<code>ExitNodeGenerator</code> discussed above, but it is intended to generate models with
<code>UserControlled</code> and <code>ReturnedToUser</code> annotations for graphene-style GraphQL
<code>resolver</code> functions.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="annotatedfreefunctionwithdecoratorgenerator"><a href="https://github.com/facebook/pyre-check/blob/main/tools/generate_taint_models/get_annotated_free_functions_with_decorator.py" target="_blank" rel="noopener noreferrer"><code>AnnotatedFreeFunctionWithDecoratorGenerator</code></a><a class="hash-link" href="#annotatedfreefunctionwithdecoratorgenerator" title="Direct link to heading">â€‹</a></h3><p>This model generator provides general purpose functionality to annotate all free
functions which have a given decorator. The annotations can be used to mark any
of the function&#x27;s arguments or return types as sources, sinks, features, etc.
This is useful whenever you have a function which modifies taint analysis
expectations. For example, if you had a decorator which applies rate limiting to
functions, you could use this model generator to add a feature to all flow passing
through rate limited functions, to enable you to filter them out from a given
rule.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="writing-model-generators">Writing Model Generators<a class="hash-link" href="#writing-model-generators" title="Direct link to heading">â€‹</a></h2><p>All model generator code lives in
<a href="https://github.com/facebook/pyre-check/tree/main/tools/generate_taint_models" target="_blank" rel="noopener noreferrer"><code>tools/generate_taint_models</code></a>
within the pyre-check repository.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="adding-a-new-model-generator">Adding a new model generator<a class="hash-link" href="#adding-a-new-model-generator" title="Direct link to heading">â€‹</a></h3><p><a href="https://github.com/facebook/pyre-check/commit/ea900c5e77d4c6d951e9c42b7310613f7f6edf08#diff-9ef72470683730531933e74a50ea98a1" target="_blank" rel="noopener noreferrer">This commit</a>
provides an example of how to add a new model generator.</p><p>The basic workflow is:</p><ol><li>Create a new file under <code>generate_taint_models</code> of the form <code>get_&lt;pattern of model&gt;</code>.</li><li>Write a class that inherits from <a href="https://github.com/facebook/pyre-check/blob/main/tools/generate_taint_models/model_generator.py" target="_blank" rel="noopener noreferrer">ModelGenerator</a>.</li><li>Collect all the callables you&#x27;re interested in modeling via <code>gather_functions_to_model</code>.</li><li>Convert the callables you&#x27;ve collected into models. The <a href="https://github.com/facebook/pyre-check/blob/main/tools/generate_taint_models/model.py" target="_blank" rel="noopener noreferrer">CallableModel</a> class is a convenience that pretty prints things in the right way - you just need to specify what kind of taint the parameters and return value should have, specify the callable to model, and call generate().</li><li>Write unit tests (<a href="https://github.com/facebook/pyre-check/blob/922410239404aa436691754402b0c3db68c5a46f/tools/generate_taint_models/tests/get_annotated_free_functions_with_decorator_test.py" target="_blank" rel="noopener noreferrer">example</a>).</li><li>Import your new class in the <code>__init__</code> file (<a href="https://github.com/facebook/pyre-check/blob/922410239404aa436691754402b0c3db68c5a46f/tools/generate_taint_models/__init__.py#L7" target="_blank" rel="noopener noreferrer">example</a>).</li></ol><div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/pyre-check/tree/main/documentation/website/docs/pysa_precollectors.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/pysa-shipping-rules-models/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Shipping Pysa Models and Rules</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/pysa-model-dsl/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Model DSL</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#running-model-generators" class="table-of-contents__link toc-highlight">Running Model Generators</a></li><li><a href="#example-model-generators" class="table-of-contents__link toc-highlight">Example Model Generators</a><ul><li><a href="#restapisourcegenerator" class="table-of-contents__link toc-highlight"><code>RESTApiSourceGenerator</code></a></li><li><a href="#exitnodegenerator" class="table-of-contents__link toc-highlight"><code>ExitNodeGenerator</code></a></li><li><a href="#graphqlsourcegenerator" class="table-of-contents__link toc-highlight"><code>GraphQLSourceGenerator</code></a></li><li><a href="#annotatedfreefunctionwithdecoratorgenerator" class="table-of-contents__link toc-highlight"><code>AnnotatedFreeFunctionWithDecoratorGenerator</code></a></li></ul></li><li><a href="#writing-model-generators" class="table-of-contents__link toc-highlight">Writing Model Generators</a><ul><li><a href="#adding-a-new-model-generator" class="table-of-contents__link toc-highlight">Adding a new model generator</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noreferrer noopener" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noreferrer noopener" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.fb.com/" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/meta_open_source_logo.svg" alt="Meta Open Source Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/meta_open_source_logo.svg" alt="Meta Open Source Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright &#169; 2024 Meta Platforms, Inc.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.244374e3.js"></script>
<script src="/assets/js/main.ba1c0690.js"></script>
</body>
</html>